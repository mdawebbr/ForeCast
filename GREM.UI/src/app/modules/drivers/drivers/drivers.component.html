<div class="col-md-12 mb-5">
    <div class="container-fluid mt-4">
      <!-- <h1>Carga de Forecash</h1> -->
      <nav aria-label="breadcrumb">
          <ol class="breadcrumb mt-3 p-0">
            <li class="breadcrumb-item">Início</li>
            <li class="breadcrumb-item active" aria-current="page">Carga de Forecast</li>
          </ol>
        </nav>
        <hr/>
    </div>
    <div class="container-fluid">
      <div class="row">
        <div class="col-sm-12 mb-3">
          <div class="float-right">
            <!-- <button class="btn btn-sm btn-light" [routerLink]="['/']"><i class="fas fa-undo-alt"></i> Voltar</button> -->
            <!-- <a (click)="downloadCSV()" style="color:white" class="btn btn-sm btn-info objectClick"> -->
            <!-- <i class="fa fa-file-excel-o objectClick" style="color:black" (click)="downloadCSV()"></i> &nbsp; -->
            <a (click)="downloadCSV()" style="color:white" class="btn btn-sm btn-dark objectClick"><i class="fa fa-file"></i> Gerar IR </a>&nbsp;
            <a (click)="abrirModalAdicionar()" style="color:white" class="btn btn-sm btn-info objectClick"><i class="fas fa-plus-square"></i> Adicionar</a>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <a>Carga de Forecast</a>
        </div>
        <div class="card-body">
            <div class="col-sm-12 mt-3">
                <!-- <table class="mb-3">
                  <tr>
                    <td>
                      <div class="input-group">
                        <input #buscarapida type="text" class="form-control form-control-sm" placeholder="Busca Rápida..." aria-label="Busca Rápida..." aria-describedby="basic-addon2">
                        <div class="input-group-append">
                          <button (click)="applyFilter(buscarapida)" class="btn btn-sm btn-primary" type="button"><i class="fas fa-search"></i></button>
                        </div>
                      </div>
                    </td>
                    <td class="">
                      <button data-toggle="modal" data-target="#filtroModal" class="btn btn-sm btn-light ml-2"><i class="fas fa-search-plus"></i> Filtro Avançado</button>
                    </td>
                  </tr>
                </table> -->

                <div class="row">
                  <div class="col-sm-3">
                    <mat-form-field>
                      <mat-label>Cliente</mat-label>
                      <mat-select #clienteIdFiltro (selectionChange)="onClienteChange($event)">
                        <mat-option>
                          Selecione...
                        </mat-option>
                        <mat-option  *ngFor="let item of filtroCliente" [value]="item.Cliente_id">
                          {{item.Nome}}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>

                  <div class="col-sm-3">
                    <mat-form-field>
                      <mat-label>Meio de Transporte</mat-label>
                      <mat-select #transporteIdFiltro (selectionChange)="onTransporteChange($event)">
                        <mat-option>
                          Selecione...
                        </mat-option>
                        <mat-option  *ngFor="let item of filtroMeioTransporte" [value]="item.Id">
                          <i [class]="item.Icone"></i>&nbsp;
                          {{item.Nome}}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>

                  <div class="col-sm-3">
                    <mat-form-field>
                      <mat-label>PEA</mat-label>
                      <mat-select #peaAno (selectionChange)="onPEAChange($event)" [(ngModel)]="filtroAnoPea">
                        <!-- <mat-option>
                          Selecione...
                        </mat-option> -->
                        <mat-option  *ngFor="let item of listaAnos" [value]="item">
                          {{item}}/{{item+1}}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                  <div class="col-sm-3">
                    <!-- <label>&nbsp;</label>
                    <input type="checkbox" data-toggle="toggle" (click)="mudaFlagTodosMeses()" > &nbsp; Visualizar todos os meses -->
                    <section class="example-section" style="margin-top: 5%;">
                      <mat-checkbox class="example-margin" (click)="mudaFlagTodosMeses()">Visualizar todos os meses</mat-checkbox>
                    </section>
                  </div>

                  <!-- <input id="toggle-trigger" type="checkbox" data-toggle="toggle" style="float: right;"> -->
                </div>
                <div *ngIf="!todosMeses">
                  <ul class="nav nav-tabs">
                    <li class="nav-item">
                      <a class="nav-link objectClick" [ngClass]="{'active': mesAtivo == 7}"  (click)="applyMonth(7)">Julho</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link objectClick" [ngClass]="{'active': mesAtivo == 8}"  (click)="applyMonth(8)">Agosto</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link objectClick" [ngClass]="{'active': mesAtivo == 9}"  (click)="applyMonth(9)">Setembro</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link objectClick" [ngClass]="{'active': mesAtivo == 10}" (click)="applyMonth(10)">Outubro</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link objectClick" [ngClass]="{'active': mesAtivo == 11}"  (click)="applyMonth(11)">Novembro</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link objectClick" [ngClass]="{'active': mesAtivo == 12}"  (click)="applyMonth(12)">Dezembro</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link objectClick" [ngClass]="{'active': mesAtivo == 1}"  (click)="applyMonth(1)">Janeiro</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link objectClick" [ngClass]="{'active': mesAtivo == 2}" (click)="applyMonth(2)">Fevereiro</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link objectClick" [ngClass]="{'active': mesAtivo == 3}"  (click)="applyMonth(3)">Março</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link objectClick" [ngClass]="{'active': mesAtivo == 4}"  (click)="applyMonth(4)">Abril</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link objectClick" [ngClass]="{'active': mesAtivo == 5}"  (click)="applyMonth(5)">Maio</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link objectClick" [ngClass]="{'active': mesAtivo == 6}" (click)="applyMonth(6)">Junho</a>
                    </li>
                  </ul>
                  <div class="table-responsive" *ngIf="tmp.length > 0">
                    <table class="table table-striped" id="fornecedorTransportadorGrid" name="fornecedorTransportadorGrid">
                        <tr>
                            <th>Dia</th>
                            <th>Clientes</th>
                            <th>Total/Dia</th>
                        </tr>

                        <tr *ngFor="let item of tmp">
                            <td style="width: 7%;">{{item.Dia}}</td>
                            <td *ngIf="item.ListaCliente=='' ">&nbsp;</td>
                            <td style="width: 84%;" *ngIf="item.ListaCliente != '' ">
                              <div  *ngFor="let tes of item.ListaCliente" style="float: left; padding-right: 3px;">
                                <span *ngIf="">{{tes}}</span>
                                <span class="badge badge-dark fontNotBold objectClick" [ngStyle]="{ 'background-color': tes.Cor }" matTooltip={{tes.Pacote}}>
                                  <span (click)="abrirModalAlterar(tes.Id, tes.Cliente.Nome, item.Dia, tes.Valor, tes.MeioTransporte.Id, tes.Pacote)"><i [class]="tes.MeioTransporte.Icone"></i>&nbsp;{{tes.ClienteValor}}</span>&nbsp;
                                  <i class="fa fa-times" style="color: red;" aria-hidden="true" (click)="Remover(tes.Id)"></i>
                                </span>
                              </div>
                            </td>
                            <td style="width: 9%; text-align: center; font-weight: bold;">
                              {{item.ValorTotalDia.toLocaleString('pt-BR')}}
                            </td>
                        </tr>
                        <tr>
                          <td></td>
                          <td style="text-align: right; font-weight: bold;">Total/Mês:</td>

                          <td style="text-align: center; font-weight: bold;">
                            {{totalMes.toLocaleString('pt-BR')}}
                          </td>
                        </tr>
                    </table>
                  </div>

                </div>

                <div *ngIf="todosMeses">
                  <div class="table-responsive" *ngIf="tmp.length > 0">
                    <table class="table table-striped" id="fornecedorTransportadorGrid" name="fornecedorTransportadorGrid">
                        <tr>
                            <th>Dia</th>
                            <th>Julho</th>
                            <th>Agosto</th>
                            <th>Setembro</th>
                            <th>Outubro</th>
                            <th>Novembro</th>
                            <th>Dezembro</th>
                            <th>Janeiro</th>
                            <th>Fevereiro</th>
                            <th>Março</th>
                            <th>Abril</th>
                            <th>Maio</th>
                            <th>Junho</th>
                            <th>Total/Dia</th>
                        </tr>

                        <tr *ngFor="let item of tmpTodosMeses">
                            <td style="width: 7%;">{{item.Dia}}</td>
                            <td *ngIf="item.ListaMes=='' ">&nbsp;</td>
                            <td *ngFor="let tes of item.ListaMes" style="text-align: center;">
                                 <span *ngIf="tes.TemValor" >
                                  <i class="fa fa-check-square objectClick" style="color: #32cd32" (click)="abrirModalMesDia(item.Dia, tes.Mes)" aria-hidden="true"></i>
                                </span>

                            </td>
                            <td style="width: 9%; text-align: center; font-weight: bold;">
                              {{item.ValorTotalDia.toLocaleString('pt-BR')}}
                            </td>
                        </tr>
                        <tr>
                          <td style="text-align: center; font-weight: bold;">Total/Mês:</td>
                          <td *ngFor="let item of listaTotalMeses" style="text-align: center; font-weight: bold;">
                            {{item.Valor.toLocaleString('pt-BR')}}
                          </td>
                          <td style="text-align: center; font-weight: bold;">
                            {{total.toLocaleString('pt-BR')}}
                          </td>
                        </tr>
                    </table>
                  </div>

                </div>

          </div>
        </div>
      </div>
    </div>




   <div class="modal fade" id="modalMesDia" tabindex="-1" role="dialog" aria-labelledby="modalMesDia" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <div class="card-header">{{mesSelecionado}}</div>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="table-responsive" *ngIf="tmpDiaMes.length > 0">
            <table class="table table-striped" id="fornecedorTransportadorGrid" name="fornecedorTransportadorGrid">
                <tr>
                    <th>Dia</th>
                    <th>Clientes</th>
                    <th>Total/Dia</th>
                </tr>

                <tr *ngFor="let item of tmpDiaMes">
                    <td style="width: 7%;">{{item.Dia}}</td>
                    <td *ngIf="item.ListaCliente=='' ">&nbsp;</td>
                    <td style="width: 84%;" *ngIf="item.ListaCliente != '' ">
                      <div  *ngFor="let tes of item.ListaCliente" style="float: left; padding-right: 3px;">
                        <span *ngIf="">{{tes}}</span>
                        <span class="badge badge-dark fontNotBold objectClick" [ngStyle]="{ 'background-color': tes.Cor }" >
                          <span (click)="abrirModalAlterar(tes.Id, tes.Cliente.Nome, item.Dia, tes.Valor, tes.MeioTransporte.Id, tes.Pacote)"><i [class]="tes.MeioTransporte.Icone"></i>&nbsp;{{tes.ClienteValor}}</span>&nbsp;
                          <i class="fa fa-times" style="color: red;" aria-hidden="true" (click)="Remover(tes.Id)"></i>
                        </span>
                      </div>
                    </td>
                    <td style="width: 9%; text-align: center;">
                      {{item.ValorTotalDia.toLocaleString('pt-BR')}}
                    </td>
                </tr>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="filtroModal" tabindex="-1" role="dialog" aria-labelledby="filtroModal" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <!-- <h5 class="modal-title" id="exampleModalLabel">Filtro Avançado</h5> -->
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-sm-6">
              <mat-form-field>
                <mat-label>Cliente1</mat-label>
                <mat-select #clienteIdFiltro >
                  <mat-option>
                    Selecione...
                  </mat-option>
                  <mat-option  *ngFor="let item of filtroCliente" [value]="item.Cliente_id">
                    {{item.Nome}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div class="col-sm-6">
              <mat-form-field>
                <mat-label>Meio de Transporte</mat-label>
                <mat-select #transporteIdFiltro >
                  <mat-option>
                    Selecione...
                  </mat-option>
                  <mat-option  *ngFor="let item of filtroMeioTransporte" [value]="item.Id">
                    {{item.Nome}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>
          <div class="modal-footer">
            <!-- <button type="button" (click)="Filter(clienteIdFiltro, transporteIdFiltro)" class="btn btn-primary">Buscar</button> -->
          </div>
        </div>
      </div>
    </div>
  </div>



  <div class="modal fade" id="modalAlterar" tabindex="-1" role="dialog" aria-labelledby="modalAlterar" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <div class="card-header">Alterar | Dia {{diaAlterar}}: {{clienteAlterar}}</div>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-sm-6">
              <mat-form-field>
                <mat-label class="required">Valor</mat-label>
                <input matInput #valor [(ngModel)]="valorAlterar">
              </mat-form-field>
            </div>
            <div class="col-sm-6">
              <mat-form-field>
                <mat-label>Meio de Transporte</mat-label>
                <mat-select #transporteId [(ngModel)]="meioTransporte_Id">
                  <mat-option>
                    Selecione...
                  </mat-option>
                  <mat-option  *ngFor="let item of filtroMeioTransporte" [value]="item.Id">
                    <i [class]="item.Icone"></i>&nbsp;
                    {{item.Nome}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-12">
              <mat-form-field>
                <mat-label>Pacote</mat-label>
                <input matInput #pacote [(ngModel)]="pacoteAlterar">
              </mat-form-field>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" (click)="Alterar(idAlterar, valor, transporteId, pacote)" class="btn btn-primary">Salvar</button>
          </div>
        </div>
      </div>
    </div>
  </div>




  <div class="modal fade" id="modalAdicionar" tabindex="-1" role="dialog" aria-labelledby="modalAdicionar" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <div class="card-header">Adicionar</div>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-sm-6">
              <mat-form-field>
                <mat-label class="required">Cliente</mat-label>
                <mat-select #clienteIdAdd multiple>
                  <mat-option>
                    Selecione...
                  </mat-option>
                  <mat-option  *ngFor="let item of filtroCliente" [value]="item.Cliente_id">
                    {{item.Nome}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div class="col-sm-6">
              <mat-form-field>
                <mat-label class="required">Meio de Transporte</mat-label>
                <!-- <mat-select #transporteId>   [(ngModel)]="meioTransporte_Id" -->
                <mat-select #transporteIdAdd>
                  <mat-option>
                    Selecione...
                  </mat-option>
                  <mat-option  *ngFor="let item of filtroMeioTransporte" [value]="item.Id">
                    <i [class]="item.Icone"></i>&nbsp;
                    {{item.Nome}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div class="col-sm-6">
              <mat-form-field>
                <mat-label class="required">Dias</mat-label>
                <!-- <mat-select #transporteId>   [(ngModel)]="meioTransporte_Id" -->
                <mat-select #diasAdd aria-placeholder="Selecione os dias" multiple>
                  <!-- <mat-option>
                    Selecione...
                  </mat-option> -->
                  <mat-option  *ngFor="let item of listaDias" [value]="item">
                    {{item}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div class="col-sm-6">
              <mat-form-field>
                <mat-label class="required">Meses</mat-label>
                <!-- <mat-select #transporteId>   [(ngModel)]="meioTransporte_Id" -->
                <mat-select #mesesAdd aria-placeholder="Selecione os meses" multiple >
                  <!-- <mat-option>
                    Selecione...
                  </mat-option> -->
                  <mat-option value=7>
                    Julho
                  </mat-option>
                  <mat-option value=8>
                    Agosto
                  </mat-option>
                  <mat-option value=9>
                    Setembro
                  </mat-option>
                  <mat-option value=10>
                    Outubro
                  </mat-option>
                  <mat-option value=11>
                    Novembro
                  </mat-option>
                  <mat-option value=12>
                    Dezembro
                  </mat-option>
                  <mat-option value=1>
                    Janeiro
                  </mat-option>
                  <mat-option value=2>
                    Fevereiro
                  </mat-option>
                  <mat-option value=3>
                    Março
                  </mat-option>
                  <mat-option value=4>
                    Abril
                  </mat-option>
                  <mat-option value=5>
                    Maio
                  </mat-option>
                  <mat-option value=6>
                    Junho
                  </mat-option>

                  <!-- <mat-option  *ngFor="let item of listaMeses" [value]="item">
                    {{item}}
                  </mat-option> -->
                </mat-select>
              </mat-form-field>
            </div>
            <div class="col-sm-6">
              <mat-form-field>
                <mat-label class="required">PEA</mat-label>
                <mat-select #peaAnoAdd>
                  <!-- <mat-option>
                    Selecione...
                  </mat-option> -->
                  <mat-option  *ngFor="let item of listaAnos" [value]="item">
                    {{item}}/{{item+1}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div class="col-sm-6">
              <mat-form-field>
                <mat-label class="required">Valor</mat-label>
                <input matInput #valorAdd>
                <!-- <input matInput type="number" class="example-right-align">
                <span matPrefix>R$&nbsp;</span>
                <span matSuffix>.00</span> -->
              </mat-form-field>
              <!-- <mat-form-field class="example-full-width">
                <mat-label>Valor</mat-label>
                <input valorAdd placeholder="Informe um valor...">
              </mat-form-field> -->
            </div>

            <!-- <div class="col-sm-6">
              <mat-form-field>
                <mat-label>Cliente</mat-label>
                <mat-select #clienteIdFiltro >
                  <mat-option>
                    Selecione...
                  </mat-option>
                  <mat-option  *ngFor="let item of filtroCliente" [value]="item.Id">
                    {{item.Nome}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div class="col-sm-6">
              <mat-form-field>
                <mat-label>Meio de Transporte</mat-label>
                <mat-select #transporteIdFiltro >
                  <mat-option>
                    Selecione...
                  </mat-option>
                  <mat-option  *ngFor="let item of filtroMeioTransporte" [value]="item.Id">
                    {{item.Nome}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div> -->
          </div>
          <div class="modal-footer">
            <button type="button" (click)="Adicionar(clienteIdAdd, transporteIdAdd, diasAdd, mesesAdd, peaAnoAdd, valorAdd.value)" class="btn btn-primary">Salvar</button>
          </div>
        </div>
      </div>
    </div>
  </div>
